---
title: "Greeks"
classes: wide
toc: true
toc_sticky: true
htmlwidgets: true
output: html_document
categories: 
  - Post
last_modified_at: 2021-04-15
tags:
  - structured product
  - financial engineering
  - black scholes  
htmlwidgets: true
---


<p> 
Any data analysis report can be more interesting with interactive charts and tables. Readers enjoy being able to ask questions of the data themselves to confirm your conclusions.  You can add interactivity to your analyses by using Plotly. Plotly is a powerful software tool that enables you to make amazing charts with R. </p>
<p>
My first thought after playing around with the library was wondering if I could use it when sharing to my website. My site is hosted on Github and powered by Jekyll. You can see the repo <a href= "http://www.github.com/kuhnrl30/kuhnrl30.github.io">here</a>. I usually knit my blog posts to a markdown file but that doesn't work with Plotly- the charts don't show up in the post. I searched for step-by-step instructions on how to make it work and came up empty handed.  I did find <a href="https://brendanrocks.com/htmlwidgets-knitr-jekyll">this post</a> which pointed me in the right direction but it took a little editing from there. Here is what I learned.
</p>

<h3>How to Build a Blog Post with Plotly from an .RMD for Your Github Hosted Blog</h3>
<ol>
<li>Starting with the post itself, you'll have to write with html tags instead of using markdown. For me, that consisted of using &lt;h3&gt; instead of ### for headers and &lt;ul&gt; and &lt;li&gt; for lists. It's an inconvenience but it shouldn't stop you from writing your post. </li>
<li> Add this line to your YAML front-matter: <code>htmlwidgets: TRUE</code>. By the end of this post you'll understand why this is neccessary but the short version is you'll use this switch to indicate if your post includes Plotly. Loading the page will probably take longer than a regular page so using this switch means we'll only have the delay when necessary. 
<li>Edit your _layouts/post.html file to include this code snippet. This checks for the htmlwidgets switch from the previous step and if its found, builds in a link to all of the dependency files. I call them dependency files because they are Javascript libraries that power Plotly charts- your site now depends on these library files. Without them you'll only see a blank space in your blog. </li>

<pre>
{% raw %}{% if page.htmlwidgets %}
{% for html_dep in site.static_files %}
  {% if html_dep.path contains 'htmlwidgets_deps/' %}
    {% assign start = "&#060;script src=" | append: {{site.baseurl}} %}
    {{html_dep.path | prepend: start | append: "&#062;&#060;/script>" }}
    {% endif %}
  {% endfor %}
{% endif %}{% endraw %}
</pre>

<li> Now we have to either build a makefile or edit the file you are already using. We can't use the Knit HTML button from within RStudio because it won't know it needs to link with the dependency files.  We start the makefile by downloading the <a href="https://github.com/brendan-r/brocks">brocks package</a> built by Brendan Rocks. (With many thanks!)  This package will take care of a lot of the back end tasks for us. 

<pre>
devtools::install_github("brendan-R/brocks")
library(brocks)
</pre>

With that package now installed, then the next step is to start on the build file. My build file uses <a href="http://www.ryankuhn.net/scripts/MakeFile">this script</a>, but the key functions are:

<pre>
filename <- "your-blog-post.Rmd"
knit(input= filename,
     output=output,
     encoding= 'UTF-8')
htmlwidgets_deps(paste0(Sys.Date(),"-",filename), always = T)
</pre>

Once you run those lines, you will have a knitted post and a new directory called <code>htmlwidgets_deps</code>.  This new directory holds Javascript libraries  from step 2 & 3. </p>
<p>
The function will also create a directory called _includes/htmlwidgets but the snippet we added to your posts.html file makes this other directory unnecessary. I recommend not pushing it to Github.</p> 
<p>
To bring it all together, Step 2 is the switch to look for the Javascript libraries. If any are detected Step 3 will create the link between the post and Javascript libraries. Finally in Step 4 the libraries are saved to the root directory.</p>

</ol>

<h3>A Few Demonstrations</h3>

<pre>
plot_ly(x= mpg,
        y= disp,
        data= mtcars,
        mode="markers") 
</pre>

<!--html_preserve--><div id="htmlwidget-179" style="width:432px;height:288px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-179">{"x":{"data":[{"type":"scatter","inherit":false,"x":[21,21,22.8,21.4,18.7,18.1,14.3,24.4,22.8,19.2,17.8,16.4,17.3,15.2,10.4,10.4,14.7,32.4,30.4,33.9,21.5,15.5,15.2,13.3,19.2,27.3,26,30.4,15.8,19.7,15,21.4],"y":[160,160,108,258,360,225,360,146.7,140.8,167.6,167.6,275.8,275.8,275.8,472,460,440,78.7,75.7,71.1,120.1,318,304,350,400,79,120.3,95.1,351,145,301,121],"mode":"markers"}],"layout":{"xaxis":{"title":"mpg"},"yaxis":{"title":"disp"},"hovermode":"closest","margin":{"b":40,"l":60,"t":25,"r":10}},"url":null,"width":null,"height":null,"source":"A","config":{"modeBarButtonsToRemove":["sendDataToCloud"]},"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->
<br>
<br>
<h4> This next one is fun, go ahead and drag this one around to get a better view!</h4>
<pre>
dat<- MASS::kde2d(x= iris$Sepal.Length, 
                y= iris$Sepal.Width, 
                h= iris$Petal.Length, 
                n= 50)

plot_ly(x = x,
        y = y,
        z = z,
        data = dat,
        type="surface",
        colorscale="Greens")
</pre>
<!--html_preserve--><div id="htmlwidget-7793" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-7793">{"x":{"data":[{"type":"surface","inherit":false,"x":[4.3,4.3734693877551,4.4469387755102,4.52040816326531,4.59387755102041,4.66734693877551,4.74081632653061,4.81428571428571,4.88775510204082,4.96122448979592,5.03469387755102,5.10816326530612,5.18163265306122,5.25510204081633,5.32857142857143,5.40204081632653,5.47551020408163,5.54897959183673,5.62244897959184,5.69591836734694,5.76938775510204,5.84285714285714,5.91632653061224,5.98979591836735,6.06326530612245,6.13673469387755,6.21020408163265,6.28367346938776,6.35714285714286,6.43061224489796,6.50408163265306,6.57755102040816,6.65102040816327,6.72448979591837,6.79795918367347,6.87142857142857,6.94489795918367,7.01836734693878,7.09183673469388,7.16530612244898,7.23877551020408,7.31224489795918,7.38571428571429,7.45918367346939,7.53265306122449,7.60612244897959,7.67959183673469,7.7530612244898,7.8265306122449,7.9],"y":[2,2.04897959183673,2.09795918367347,2.1469387755102,2.19591836734694,2.24489795918367,2.29387755102041,2.34285714285714,2.39183673469388,2.44081632653061,2.48979591836735,2.53877551020408,2.58775510204082,2.63673469387755,2.68571428571429,2.73469387755102,2.78367346938776,2.83265306122449,2.88163265306122,2.93061224489796,2.97959183673469,3.02857142857143,3.07755102040816,3.1265306122449,3.17551020408163,3.22448979591837,3.2734693877551,3.32244897959184,3.37142857142857,3.42040816326531,3.46938775510204,3.51836734693878,3.56734693877551,3.61632653061224,3.66530612244898,3.71428571428571,3.76326530612245,3.81224489795918,3.86122448979592,3.91020408163265,3.95918367346939,4.00816326530612,4.05714285714286,4.10612244897959,4.15510204081633,4.20408163265306,4.2530612244898,4.30204081632653,4.35102040816327,4.4],"z":[[0.0100932496016613,0.0115991414396233,0.013210315037915,0.0149344071304028,0.0167886569254629,0.0188015054922087,0.0210127945843937,0.0234721213618376,0.0262350970083624,0.0293575349902751,0.0328879254793546,0.0368588867143731,0.0412785631757851,0.046123107178998,0.051331390698567,0.0568029272554817,0.0623996490602409,0.0679517230984308,0.0732670681868281,0.0781437347215903,0.0823839113012028,0.0858080933850858,0.088267925852017,0.0896564151571859,0.0899145634042623,0.08903394330495,0.0870552315126955,0.0840631701275619,0.0801787689455043,0.0755497561765069,0.070340324417976,0.064721120649652,0.0588602328605165,0.0529156799270188,0.0470296623322804,0.0413246158935198,0.0359009504964314,0.0308362569372686,0.0261857206372919,0.0219834768033569,0.0182446609029578,0.0149679366846494,0.0121383118731221,0.00973007506401129,0.00770970665339404,0.00603863477112517,0.00467572745722092,0.00357943683960304,0.00270953997529016,0.00202845251922786],[0.0126340105626857,0.0144752496037526,0.0164341997252844,0.0185165680830624,0.0207392161273837,0.0231323512509991,0.025740171680013,0.0286194154763135,0.0318354686311336,0.0354559960556297,0.0395424379042695,0.0441401071562146,0.0492679655946919,0.0549093766872922,0.0610051809133716,0.0674502829812525,0.0740945864998926,0.080748601812854,0.0871934598615835,0.0931944811779091,0.0985169686983653,0.102942594502975,0.106284681117738,0.108400844742336,0.109201836701695,0.108655923273822,0.106788696516845,0.103678722049108,0.0994498314096676,0.0942611115348685,0.0882957196145179,0.0817495762846204,0.0748208042463463,0.0677005340865465,0.0605654440902713,0.0535721751570286,0.0468535885481793,0.040516719599411,0.0346422180810392,0.0292850413338024,0.0244761636750321,0.0202250717877725,0.0165228232026978,0.0133454515388474,0.0106575100302999,0.00841555799540772,0.00657141676671449,0.00507505354261889,0.00387699228254607,0.00293019643683233],[0.0154898657954521,0.0176974944668698,0.0200341435783561,0.0225024446557536,0.0251175521355362,0.027910002144153,0.0309269262917197,0.0342309621821036,0.0378964103093759,0.0420025185147235,0.0466241951519715,0.0518209016475248,0.0576248795557469,0.0640301488734245,0.0709838080715517,0.0783810339232779,0.0860648203461294,0.0938309510487562,0.101438048180503,0.108621879427858,0.115112545099154,0.120652795312512,0.125015602993995,0.128019254523413,0.129538584366062,0.1295115029587,0.127940556251759,0.124889815401958,0.120477846360791,0.114867800688662,0.108255784924712,0.100858623028758,0.0929019653590723,0.0846094701731042,0.0761935400577913,0.0678478749807978,0.059741928284883,0.0520172278195417,0.0447854447239921,0.0381280436724814,0.0320973165802689,0.0267185766260251,0.0219932666750948,0.017902717058036,0.0144122769318581,0.0114755465978109,0.00903845884585909,0.00704299599056671,0.00543038247344488,0.00414365460854947],[0.0186185207998511,0.0212193167826779,0.0239594361866348,0.0268371636439166,0.0298643467133587,0.0330699705496374,0.0365020516623237,0.0402270857920482,0.0443264866890916,0.0488897959195947,0.0540048952636833,0.059745951709191,0.0661602897378674,0.0732557298116973,0.0809900799563241,0.0892643711598607,0.0979210794760683,0.10674801639612,0.115487873811178,0.123852688360066,0.131541857783806,0.138261900290803,0.14374596382258,0.147771185613066,0.150172344355628,0.15085076717449,0.149778056134337,0.146994784641443,0.142604798687719]],"colorscale":"Greens","colorbar":{"title":"z"},"colorscale.1":[[0,"#440154"],[0.111111111111111,"#482878"],[0.222222222222222,"#3E4A89"],[0.333333333333333,"#31688E"],[0.444444444444444,"#26828E"],[0.555555555555555,"#1F9E89"],[0.666666666666667,"#35B779"],[0.777777777777778,"#6DCD59"],[0.888888888888889,"#B4DE2C"],[1,"#FDE725"]]}],"layout":{"scene":{"xaxis":{"title":"x"},"yaxis":{"title":"y"},"zaxis":{"title":"z"}},"margin":{"b":40,"l":60,"t":25,"r":10}},"url":null,"width":null,"height":null,"source":"A","config":{"modeBarButtonsToRemove":["sendDataToCloud"]},"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->